<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Compute the diversity of the destination locations in a spatial interaction model — diversity • blvim</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compute the diversity of the destination locations in a spatial interaction model — diversity"><meta name="description" content='This function computes the diversity of the destination locations according
to different definitions that all aim at estimating a number of active
destinations, i.e., the number of destination locations that receive a
"significant fraction" of the total flow or that are attractive enough. The
function applies also to a collection of spatial interaction models as
represented by a sim_list.'><meta property="og:description" content='This function computes the diversity of the destination locations according
to different definitions that all aim at estimating a number of active
destinations, i.e., the number of destination locations that receive a
"significant fraction" of the total flow or that are attractive enough. The
function applies also to a collection of spatial interaction models as
represented by a sim_list.'><meta property="og:image" content="https://fabrice-rossi.github.io/blvim/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">blvim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/grid.html">Systematic exploration of the BLV solution space</a></li>
    <li><a class="dropdown-item" href="../articles/theory.html">Theoretical Background</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://fabrice-rossi.github.io/blog/posts/blvim-0-1.html">blvim 0.1.1</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/fabrice-rossi/blvim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Compute the diversity of the destination locations in a spatial interaction model</h1>
      <small class="dont-index">Source: <a href="https://github.com/fabrice-rossi/blvim/blob/main/R/diversity.R" class="external-link"><code>R/diversity.R</code></a></small>
      <div class="d-none name"><code>diversity.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function computes the diversity of the destination locations according
to different definitions that all aim at estimating a number of active
destinations, i.e., the number of destination locations that receive a
"significant fraction" of the total flow or that are attractive enough. The
function applies also to a collection of spatial interaction models as
represented by a <code>sim_list</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">diversity</span><span class="op">(</span></span>
<span>  <span class="va">sim</span>,</span>
<span>  definition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shannon"</span>, <span class="st">"renyi"</span>, <span class="st">"ND"</span>, <span class="st">"RW"</span><span class="op">)</span>,</span>
<span>  order <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  activity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"destination"</span>, <span class="st">"attractiveness"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'sim'</span></span>
<span><span class="fu">diversity</span><span class="op">(</span></span>
<span>  <span class="va">sim</span>,</span>
<span>  definition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shannon"</span>, <span class="st">"renyi"</span>, <span class="st">"ND"</span>, <span class="st">"RW"</span><span class="op">)</span>,</span>
<span>  order <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  activity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"destination"</span>, <span class="st">"attractiveness"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'sim_list'</span></span>
<span><span class="fu">diversity</span><span class="op">(</span></span>
<span>  <span class="va">sim</span>,</span>
<span>  definition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shannon"</span>, <span class="st">"renyi"</span>, <span class="st">"ND"</span>, <span class="st">"RW"</span><span class="op">)</span>,</span>
<span>  order <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  activity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"destination"</span>, <span class="st">"attractiveness"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-sim">sim<a class="anchor" aria-label="anchor" href="#arg-sim"></a></dt>
<dd><p>a spatial interaction model object (an object of class <code>sim</code>) or a
collection of spatial interaction  models (an object of class <code>sim_list</code>)</p></dd>


<dt id="arg-definition">definition<a class="anchor" aria-label="anchor" href="#arg-definition"></a></dt>
<dd><p>diversity definition <code>"shannon"</code> (default), <code>"renyi"</code> (see
details) or a definition supported by  <code><a href="terminals.html">terminals()</a></code></p></dd>


<dt id="arg-order">order<a class="anchor" aria-label="anchor" href="#arg-order"></a></dt>
<dd><p>order of the Rényi entropy, used only when <code>definition="renyi"</code></p></dd>


<dt id="arg-activity">activity<a class="anchor" aria-label="anchor" href="#arg-activity"></a></dt>
<dd><p>specifies whether the diversity is computed based on the
destination flows (for <code>activity="destination"</code>, the default case) or on
the attractivenesses (for <code>activity="attractiveness"</code>).</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional parameters</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>the diversity of destination flows (one value per spatial
interaction model)</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>In general, the activity of a destination location is measured by its
incoming flow a.k.a. its destination flow. If \(Y\) is a flow matrix, the
destination flows are computed as follows</p>
<p>$$\forall j,\quad D_j=\sum_{i=1}^{n}Y_{ij},$$</p>
<p>for each destination \(j\) (see <code><a href="destination_flow.html">destination_flow()</a></code>). This is the default
calculation mode in this function (when the parameter <code>activity</code> is set
to <code>"destination"</code>).</p>
<p>For dynamic models produced by <code><a href="blvim.html">blvim()</a></code>, the destination attractivenesses
can be also considered as activity measures. When convergence occurs,
the values are identical, but prior convergence they can be quite different.
When <code>activity</code> is set to <code>"attractiveness"</code>, the diversity measures are
computed using the same formula as below but with \(D_j\) replaced by
\(Z_j\) (as given by <code><a href="attractiveness.html">attractiveness()</a></code>).</p>
<p>To compute their
diversity using entropy based definitions, the activities are first normalised to
be interpreted as a probability distribution over the destination locations.
For instance for destination flows, we use</p>
<p>$$\forall j,\quad p_j=\frac{D_j}{\sum_{k=1}^n D_k}.$$</p>
<p>The most classic diversity index is given by the exponential of Shannon's
entropy (parameter <code>definition="shannon"</code>). This gives</p>
<p>$$\text{diversity}(p, \text{Shannon})=\exp\left(-\sum_{k=1}^n p_k\ln
p_k\right).$$</p>
<p>Rényi generalized entropy can be used to define a collection of other
diversity metrics. The Rényi diversity of order \(\gamma\) is the
exponential of the Rényi entropy of order \(\gamma\) of the \(p\)
distribution, that is</p>
<p>$$\text{diversity}(p, \text{Rényi},
\gamma)=\exp\left(\frac{1}{1-\gamma}\ln
\left(\sum_{k=1}^np_k^\gamma\right)\right).$$</p>
<p>This is defined directly only for \(\gamma\in]0,1[\cup ]1,\infty[\), but
extensions to the limit case are straightforward:</p><ul><li><p>\(\gamma=1\) is Shannon's entropy/diversity</p></li>
<li><p>\(\gamma=0\) is the max-entropy, here \(\ln(n)\) and thus the
corresponding diversity is the number of locations</p></li>
<li><p>\(\gamma=\infty\) is the min-entropy, here \(-\log \max_{k}p_k\) and
thhe corresponding diversity is \(\frac{1}{\max_{k}p_k}\)</p></li>
</ul><p>The <code>definition</code> parameter specifies the diversity used for calculation. The
default value is <code>shannon</code> for Shannon's entropy (in this case the <code>order</code>
parameter is not used). Using <code>renyi</code> gives access to all Rényi diversities
as specified by the <code>order</code> parameter. Large values of <code>order</code> tend to
generate underflows in the calculation that will trigger the use of the
min-entropy instead of the exact Rényi entropy.</p>
<p>In addition to those entropy based definition, terminal based calculations
are also provided. Using any definition supported by the <code><a href="terminals.html">terminals()</a></code>
function, the diversity is the number of terminals identified. Notice this
applies only to interaction models in which origin and destination locations
are identical, i.e. when the model is not bipartite. In addition, the notion
of terminals is based on destination flows and cannot be used with activities
based on attractivenesses. <code>definition</code> can be:</p><ul><li><p><code>"ND"</code> for the original Nystuen and Dacey definition</p></li>
<li><p><code>"RW"</code> for the variant by Rihll and Wilson</p></li>
</ul><p>See <code><a href="terminals.html">terminals()</a></code> for details.</p>
<p>When applied to a collection of spatial interaction  models (an object of
class <code>sim_list</code>) the function uses the same parameters (<code>definition</code> and
<code>order</code>) for all models and returns a vector of diversities. This is
completely equivalent to <code><a href="grid_diversity.html">grid_diversity()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Jost, L. (2006), "Entropy and diversity", Oikos, 113: 363-375.
<a href="https://doi.org/10.1111/j.2006.0030-1299.14714.x" class="external-link">doi:10.1111/j.2006.0030-1299.14714.x</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="destination_flow.html">destination_flow()</a></code>, <code><a href="attractiveness.html">attractiveness()</a></code>, <code><a href="terminals.html">terminals()</a></code>,
<code><a href="sim_is_bipartite.html">sim_is_bipartite()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">distances</span> <span class="op">&lt;-</span> <span class="va">french_cities_distances</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">15</span><span class="op">]</span> <span class="op">/</span> <span class="fl">1000</span> <span class="co">## convert to km</span></span></span>
<span class="r-in"><span><span class="va">production</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">french_cities</span><span class="op">$</span><span class="va">population</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">attractiveness</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">15</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">flows</span> <span class="op">&lt;-</span> <span class="fu"><a href="blvim.html">blvim</a></span><span class="op">(</span><span class="va">distances</span>, <span class="va">production</span>, <span class="fl">1.5</span>, <span class="fl">1</span> <span class="op">/</span> <span class="fl">100</span>, <span class="va">attractiveness</span>,</span></span>
<span class="r-in"><span>  bipartite <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">diversity</span><span class="op">(</span><span class="va">flows</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5.612398</span>
<span class="r-in"><span><span class="fu"><a href="sim_converged.html">sim_converged</a></span><span class="op">(</span><span class="va">flows</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="co">## should be identical because of convergence</span></span></span>
<span class="r-in"><span><span class="fu">diversity</span><span class="op">(</span><span class="va">flows</span>, activity <span class="op">=</span> <span class="st">"attractiveness"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5.612397</span>
<span class="r-in"><span><span class="fu">diversity</span><span class="op">(</span><span class="va">flows</span>, <span class="st">"renyi"</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 4.734579</span>
<span class="r-in"><span><span class="fu">diversity</span><span class="op">(</span><span class="va">flows</span>, <span class="st">"RW"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 7</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Fabrice Rossi.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

