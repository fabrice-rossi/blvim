<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Systematic exploration of the BLV solution space • blvim</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Systematic exploration of the BLV solution space">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">blvim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/grid.html">Systematic exploration of the BLV solution space</a></li>
    <li><a class="dropdown-item" href="../articles/theory.html">Theoretical Background</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/fabrice-rossi/blvim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Systematic exploration of the BLV solution space</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/fabrice-rossi/blvim/blob/main/vignettes/grid.Rmd" class="external-link"><code>vignettes/grid.Rmd</code></a></small>
      <div class="d-none name"><code>grid.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fabrice-rossi.github.io/blvim/">blvim</a></span><span class="op">)</span></span>
<span><span class="co">## we use ggplot2 for graphical representations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>One of the main objectives of the <code>blvim</code> package is to
ease the systematic exploration of the BLV model’s solution space when
<span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> vary. This is supported by a
collection of <code>grid_*</code> functions.</p>
<div class="section level2">
<h2 id="locations-and-setup">Locations and setup<a class="anchor" aria-label="anchor" href="#locations-and-setup"></a>
</h2>
<p>Let us work on a regular grid of locations, in a symmetric
(non-bipartite) case.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, y <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">locations</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">locations</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, label <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>We use the Euclidean distance between the points as the interaction
costs.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">costs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">locations</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>And finally, we consider unitary productions and initial
attractivenesses.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">location_prod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">locations</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">location_att</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">locations</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="computing-a-collection-of-models">Computing a collection of models<a class="anchor" aria-label="anchor" href="#computing-a-collection-of-models"></a>
</h2>
<p>The main function for systematic exploration is
<code><a href="../reference/grid_blvim.html">grid_blvim()</a></code>, which computes a collection of spatial
interaction models (the BLV models obtained by <code><a href="../reference/blvim.html">blvim()</a></code>) for
all pairwise combinations of <span class="math inline">\(\alpha\)</span>
and <span class="math inline">\(\beta\)</span> provided.</p>
<p>For the <span class="math inline">\(\alpha\)</span> parameter, it is
generally recommended to focus on values strictly larger than 1 (setting
<span class="math inline">\(\alpha=1\)</span> significantly slows down
the convergence of the fixed-point algorithm used in the BLV model). For
<span class="math inline">\(\beta\)</span>, one wants to cover local
models (with a large <span class="math inline">\(\beta\)</span>) and
long-range ones (with a small <span class="math inline">\(\beta\)</span>). Here, distances between positions
range from 1 to approximately 7, so a typical range for <span class="math inline">\(\frac{1}{\beta}\)</span> could be <span class="math inline">\([0.5 ; 4]\)</span>.</p>
<p>The collection of models is computed by <code><a href="../reference/grid_blvim.html">grid_blvim()</a></code> as
follows. Notice that while we could specify the location data as
parameters of the call, it is generally simpler to do so on the
resulting <code><a href="../reference/sim_list.html">sim_list()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grid_blvim.html">grid_blvim</a></span><span class="op">(</span><span class="va">costs</span>,</span>
<span>  <span class="va">location_prod</span>,</span>
<span>  alphas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1.05</span>, <span class="fl">2</span>, length.out <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>  betas <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">4</span>, length.out <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>  <span class="va">location_att</span>,</span>
<span>  bipartite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  epsilon <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  iter_max <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>  conv_check <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We specify now the location data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/destination_names.html">destination_names</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">locations</span><span class="op">$</span><span class="va">name</span></span>
<span><span class="fu"><a href="../reference/destination_positions.html">destination_positions</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">locations</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>An important point to note is that the <code><a href="../reference/sim_list.html">sim_list()</a></code>
returned by <code><a href="../reference/grid_blvim.html">grid_blvim()</a></code> is <em>homogeneous</em>: it uses
the same cost matrix and the same location data. This is enforced in the
package as most of the exploration methods proposed would not make sense
for a heterogeneous collection of spatial interaction models.</p>
</div>
<div class="section level2">
<h2 id="exploring-the-results">Exploring the results<a class="anchor" aria-label="anchor" href="#exploring-the-results"></a>
</h2>
<div class="section level3">
<h3 id="single-model-extraction">Single model extraction<a class="anchor" aria-label="anchor" href="#single-model-extraction"></a>
</h3>
<p>The <code><a href="../reference/sim_list.html">sim_list()</a></code> object behaves like a read-only list. We
can therefore extract any of the models, for instance to display the
corresponding flows, as shown below for the first model, using the
standard matrix display and the position-based one.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">models</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"white"</span>, high <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">models</span><span class="op">[[</span><span class="fl">10</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  flows <span class="op">=</span> <span class="st">"full"</span>, with_positions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="st">"npc"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linewidth.html" class="external-link">scale_linewidth_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="variability-plot">Variability plot<a class="anchor" aria-label="anchor" href="#variability-plot"></a>
</h3>
<p>The <code>sim_list</code> object has a
<code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">ggplot2::autoplot()</a></code> function that provides a variability
plot. The goal is to show statistics of the flows over the collection of
spatial interaction models in the list. The default representation
focuses on individual flows as shown below.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">models</span>, with_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>For instance, the M column shows the flows received from all
locations by location M (the centre point of the locations). The thick
squares correspond to the median of the flow received by M over all the
models. The figure shows in particular that many of the locations do not
receive incoming flow in any model.</p>
<p>The position-based figure shows only the destination flows, using
circles to display statistics of those flows.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">models</span>, flows <span class="op">=</span> <span class="st">"destination"</span>, with_positions <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>he figure confirms that the external locations do not receive any
flow. The median flow received by M, the central location, is
significantly larger than other flows. The internal tiny circle for this
location shows the 0.05 quartile: this indicates that for a few models
in the list, the central location does not receive any flow. This is
illustrated for the first model of the list in the figure above.</p>
</div>
<div class="section level3">
<h3 id="statistics-oriented-display">Statistics-oriented display<a class="anchor" aria-label="anchor" href="#statistics-oriented-display"></a>
</h3>
<p>In addition to the variability of the flows, we can display a
numerical value for each spatial interaction model on a single plot. To
facilitate this display, the collection of models first has to be
integrated into a data frame-like model. This is done with the
<code><a href="../reference/sim_df.html">sim_df()</a></code> function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_df.html">sim_df</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span></span></code></pre></div>
<p>The result is a data frame with a special <code>sim</code> column
that contains the original <code><a href="../reference/sim_list.html">sim_list()</a></code> object as well as the
parameters used to build the model (<span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>), diagnostics on the
<code><a href="../reference/blvim.html">blvim()</a></code> runs, and the Shannon <code><a href="../reference/diversity.html">diversity()</a></code> of
the models.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">models_df</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">alpha</th>
<th align="right">beta</th>
<th align="right">diversity</th>
<th align="right">iterations</th>
<th align="left">converged</th>
<th align="left">sim</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1.050000</td>
<td align="right">2</td>
<td align="right">24.885897</td>
<td align="right">640</td>
<td align="left">TRUE</td>
<td align="left">c(0.6908….</td>
</tr>
<tr class="even">
<td align="right">1.089583</td>
<td align="right">2</td>
<td align="right">24.844876</td>
<td align="right">910</td>
<td align="left">TRUE</td>
<td align="left">c(0.6890….</td>
</tr>
<tr class="odd">
<td align="right">1.129167</td>
<td align="right">2</td>
<td align="right">24.758832</td>
<td align="right">2040</td>
<td align="left">TRUE</td>
<td align="left">c(0.6875….</td>
</tr>
<tr class="even">
<td align="right">1.168750</td>
<td align="right">2</td>
<td align="right">23.174828</td>
<td align="right">5001</td>
<td align="left">FALSE</td>
<td align="left">c(0.6796….</td>
</tr>
<tr class="odd">
<td align="right">1.208333</td>
<td align="right">2</td>
<td align="right">8.776566</td>
<td align="right">2640</td>
<td align="left">TRUE</td>
<td align="left">c(0.7026….</td>
</tr>
<tr class="even">
<td align="right">1.247917</td>
<td align="right">2</td>
<td align="right">5.770688</td>
<td align="right">1160</td>
<td align="left">TRUE</td>
<td align="left">c(0.5686….</td>
</tr>
</tbody>
</table>
<p>The <code><a href="../reference/sim_df.html">sim_df()</a></code> object has a
<code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">ggplot2::autoplot()</a></code> function which shows by default the
diversities of the models.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">models_df</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-13-1.png" width="576" style="display: block; margin: auto;"></p>
<p>he figure shows, for each combination of parameters <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>, a coloured rectangle that
represents the chosen numerical value for the corresponding model. One
can display any column of the <code>sim_df</code> object, for instance
the convergence status.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">models_df</span>, <span class="va">converged</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-14-1.png" width="576" style="display: block; margin: auto;"></p>
<p>The <code><a href="../reference/autoplot.sim_df.html">autoplot.sim_df()</a></code> function uses tidy evaluation,
which enables the user to compute interesting values on the fly, as in
the following figure that displays the number of terminals per model,
according to the Nystuen and Dacey definition.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">models_df</span>, <span class="fu"><a href="../reference/diversity.html">diversity</a></span><span class="op">(</span><span class="va">sim</span>, <span class="st">"ND"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-15-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="organizing-the-results">Organizing the results<a class="anchor" aria-label="anchor" href="#organizing-the-results"></a>
</h2>
<div class="section level3">
<h3 id="clustering-the-models">Clustering the models<a class="anchor" aria-label="anchor" href="#clustering-the-models"></a>
</h3>
<p>The set of all models, while structured, can be difficult to
understand completely using only the tools presented above. To push the
analysis further, it may be useful to cluster the models and to display
representative elements of the clusters. To ease this task, we support
distance-based approaches (such as hierarchical clustering and
partitioning around medoids) via <code><a href="../reference/sim_distance.html">sim_distance()</a></code>. For
instance, the following call computes all pairwise Euclidean distances
between the destination flows of the models in a
<code><a href="../reference/sim_list.html">sim_list()</a></code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_distance.html">sim_distance</a></span><span class="op">(</span><span class="va">models</span>, <span class="st">"destination"</span><span class="op">)</span></span></code></pre></div>
<p>This can then be used as the input of a hierarchical clustering.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models_hc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="va">models_dist</span>, method <span class="op">=</span> <span class="st">"ward.D2"</span><span class="op">)</span></span></code></pre></div>
<p>For the studied example, the structure of the model set is very
particular as a very large subset of them is the same model, with all
the flow sent to the central location. Part of this is clearly visible
on the dendrogram of the clustering, with the large cluster on the
left.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">models_hc</span>, hang <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, labels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>As we use clustering only to explore the result set, we can set the
number of clusters to an arbitrary value: we are not looking for a
clustering structure but rather we want to summarise the model set. A
small number of clusters will generally provide a too crude summary
while a large number will be difficult to analyse. Here, we chose
arbitrarily 16 clusters.</p>
<p>The best way to integrate the clustering result for further analysis
is to add a new column to the <code><a href="../reference/sim_df.html">sim_df()</a></code> giving the class
membership, as follows for instance:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models_df</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cutree.html" class="external-link">cutree</a></span><span class="op">(</span><span class="va">models_hc</span>, k <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This can be immediately used in the standard <code><a href="../reference/sim_df.html">sim_df()</a></code>
visualisation.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">models_df</span>, <span class="va">cluster</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-20-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="showing-cluster-variability">Showing cluster variability<a class="anchor" aria-label="anchor" href="#showing-cluster-variability"></a>
</h3>
<p>Two functions are available in <code>blvim</code> to leverage any
partition of a collection of spatial interaction models. Both of them
use <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">ggplot2::facet_wrap()</a></code> to combine standard individual
visualisations into an organised one. The first function,
<code><a href="../reference/grid_var_autoplot.html">grid_var_autoplot()</a></code>, shows a variability representation for
each of the groups identified by a partitioning variable in a
<code><a href="../reference/sim_df.html">sim_df()</a></code> object.</p>
<p>Using the clustering obtained above, we simply write:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/grid_var_autoplot.html">grid_var_autoplot</a></span><span class="op">(</span><span class="va">models_df</span>, <span class="va">cluster</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-21-1.png" width="768" style="display: block; margin: auto;"></p>
<p>This gives a flow variation panel for each of the 16 clusters. Based
on the redundancy of the display, we can guess that we asked for too
many clusters, but apart from that, the representation outlines a
collection of very distinct model classes:</p>
<ul>
<li>a model of central domination (clusters 13 to 16)</li>
<li>models with a dominant diagonal (mostly self-interaction, in
clusters 1 to 3)</li>
<li>models where the central location does not receive any flow
(clusters 4 and 9)</li>
<li>more complex patterns in clusters 5 to 8, and 10 to 12</li>
</ul>
<p>Using the location positions, we can gain more insight into the
different behaviours, provided we focus on the destination flows.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/grid_var_autoplot.html">grid_var_autoplot</a></span><span class="op">(</span><span class="va">models_df</span>, <span class="va">cluster</span>, flows <span class="op">=</span> <span class="st">"destination"</span>, with_positions <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-22-1.png" width="816" style="display: block; margin: auto;"></p>
<p>The fact that we see only one circle at most per position illustrates
the quality of the clusters (this was also the case in the previous
visualisation, but less clearly). Indeed, this means that the
destination flows are almost constant in each cluster of models.
Moreover, this representation, while blind to the actual pairwise flows,
shows the structure of the clusters. In particular, it emphasises small
differences between cluster 13 and clusters 14 to 16 (and similarly for
e.g. clusters 10 and 11).</p>
</div>
<div class="section level3">
<h3 id="finding-representative-models">Finding representative models<a class="anchor" aria-label="anchor" href="#finding-representative-models"></a>
</h3>
<p>In addition to the variability plots, one may want to extract some
representative examples from each cluster. The
<code><a href="../reference/median.sim_list.html">median.sim_list()</a></code> function provides a solution based on the
concept of generalised median (also called <em>medoid</em>): the
function returns, from a collection of spatial interaction models in a
<code><a href="../reference/sim_list.html">sim_list()</a></code>, the one that is on average the closest to all
the other models. The distance used is one of the distances provided by
<code>grid_distance()</code>. It is recommended to use the same distance
for clustering, but this is not enforced by the function (as it applies
to any <code><a href="../reference/sim_list.html">sim_list()</a></code>). In practice, we use
<code><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply()</a></code> to compute a list of medoids, and then build a
<code><a href="../reference/sim_list.html">sim_list()</a></code> and a <code><a href="../reference/sim_df.html">sim_df()</a></code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models_center</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_list.html">sim_list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">models</span>, <span class="va">models_df</span><span class="op">$</span><span class="va">cluster</span>,</span>
<span>  <span class="va">median</span>,</span>
<span>  flows <span class="op">=</span> <span class="st">"destination"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">models_center_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_df.html">sim_df</a></span><span class="op">(</span><span class="va">models_center</span><span class="op">)</span></span></code></pre></div>
<p>This small collection of models can then be displayed exhaustively,
using <code><a href="../reference/grid_autoplot.html">grid_autoplot()</a></code>. This function uses
<code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">ggplot2::facet_wrap()</a></code> to show a standard spatial
interaction model graphical representation (the ones provided by
<code><a href="../reference/autoplot.sim.html">autoplot.sim()</a></code>) for each of the models in a
<code>sim_df</code>. For instance, one can get the flows of all medoids
as follows.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/grid_autoplot.html">grid_autoplot</a></span><span class="op">(</span><span class="va">models_center_df</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"white"</span>, high <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-24-1.png" width="816" style="display: block; margin: auto;"></p>
<p>The function supports all the individual representations, for
instance flows with positions.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/grid_autoplot.html">grid_autoplot</a></span><span class="op">(</span><span class="va">models_center_df</span>,</span>
<span>  flows <span class="op">=</span> <span class="st">"full"</span>, with_positions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.015</span>, <span class="st">"npc"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linewidth.html" class="external-link">scale_linewidth_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-25-1.png" width="816" style="display: block; margin: auto;"></p>
<p>Destination flows with positions are also supported.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/grid_autoplot.html">grid_autoplot</a></span><span class="op">(</span><span class="va">models_center_df</span>, flows <span class="op">=</span> <span class="st">"destination"</span>, with_positions <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-26-1.png" width="816" style="display: block; margin: auto;"></p>
<p>In this example, the structure of the result collection is quite
simple and was already captured to a large extent by the variability
plots. In more complex situations, the series of graphics are
complementary and give a better insight on the solution space.</p>
<p>In this example, the structure of the result collection is quite
simple and was already captured to a large extent by the variability
plots. In more complex situations, the series of graphics are
complementary and give a better insight into the solution space.</p>
</div>
</div>
<div class="section level2">
<h2 id="real-world-example">Real-world example<a class="anchor" aria-label="anchor" href="#real-world-example"></a>
</h2>
<div class="section level3">
<h3 id="european-cities">European cities<a class="anchor" aria-label="anchor" href="#european-cities"></a>
</h3>
<p>Let us analyse the <code>eurodist</code> dataset, which consists of
road distances between 21 cities in Europe. We use approximate
coordinates of those cities obtained from <a href="https://www.openstreetmap.org/" class="external-link">OpenStreetMap</a>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"eurodist"</span><span class="op">)</span></span>
<span><span class="va">eurodist_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/labels.html" class="external-link">labels</a></span><span class="op">(</span><span class="va">eurodist</span><span class="op">)</span></span>
<span><span class="va">eurodist_names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="st">"Lyons"</span>, <span class="va">eurodist_names</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Lyon"</span></span>
<span><span class="va">eurodist_names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="st">"Marseilles"</span>, <span class="va">eurodist_names</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Marseille"</span></span>
<span><span class="va">eurodist_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">eurodist</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">eurodist_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">eurodist_names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">eurodist_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">eurodist_names</span></span>
<span><span class="va">eurodist_coord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">23.7337556</span>, <span class="fl">2.14541</span>, <span class="fl">4.3386684</span>, <span class="fl">1.8110332</span>, <span class="op">-</span><span class="fl">1.5839619</span>,</span>
<span>    <span class="fl">6.94851185</span>, <span class="fl">12.56571</span>, <span class="fl">6.12186775</span>, <span class="op">-</span><span class="fl">5.3482947</span>, <span class="fl">10.1185387</span>,</span>
<span>    <span class="fl">4.1148457</span>, <span class="op">-</span><span class="fl">9.1655069</span>, <span class="fl">4.83042935</span>, <span class="op">-</span><span class="fl">3.7034351</span>, <span class="fl">5.3805535</span>,</span>
<span>    <span class="fl">8.90758575</span>, <span class="fl">11.6032322</span>, <span class="fl">2.3222823</span>, <span class="fl">12.5451136</span>, <span class="fl">18.0710935</span>,</span>
<span>    <span class="fl">16.37833545</span></span>
<span>  <span class="op">)</span>,</span>
<span>  latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">37.9726176</span>, <span class="fl">41.31120535</span>, <span class="fl">50.89415265</span>, <span class="fl">50.9338734</span>, <span class="fl">49.6456093</span>,</span>
<span>    <span class="fl">50.84446155</span>, <span class="fl">55.67613</span>, <span class="fl">46.20823855</span>, <span class="fl">36.1113418</span>, <span class="fl">53.57845325</span>,</span>
<span>    <span class="fl">51.96912755</span>, <span class="fl">38.7076287</span>, <span class="fl">45.7591956</span>, <span class="fl">40.47785335</span>, <span class="fl">43.28032785</span>,</span>
<span>    <span class="fl">45.48039615</span>, <span class="fl">48.1235428</span>, <span class="fl">48.8787706</span>, <span class="fl">41.8983351</span>, <span class="fl">59.3251172</span>,</span>
<span>    <span class="fl">48.1653537</span></span>
<span>  <span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="va">eurodist_names</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This gives us the following map.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">eurodist_coord</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span>, label <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_label_repel</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>default_crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="models">Models<a class="anchor" aria-label="anchor" href="#models"></a>
</h3>
<p>We fit a collection of SIMs with a wide range of values for both
parameters.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">euro_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grid_blvim.html">grid_blvim</a></span><span class="op">(</span><span class="va">eurodist_mat</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">21</span><span class="op">)</span>,</span>
<span>  alphas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1.05</span>, <span class="fl">1.75</span>, length.out <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>  betas <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">750</span>, length.out <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">21</span><span class="op">)</span>,</span>
<span>  bipartite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  epsilon <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  iter_max <span class="op">=</span> <span class="fl">40000</span>,</span>
<span>  conv_check <span class="op">=</span> <span class="fl">50</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/destination_positions.html">destination_positions</a></span><span class="op">(</span><span class="va">euro_models</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">eurodist_coord</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">euro_models_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_df.html">sim_df</a></span><span class="op">(</span><span class="va">euro_models</span><span class="op">)</span></span></code></pre></div>
<p>Most of the parameter pairs lead to relatively fast convergence,
except for a few values.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">euro_models_df</span>, <span class="va">iterations</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-31-1.png" width="576" style="display: block; margin: auto;">
The full range of diversity possible with 21 cities is covered in the
parameter space, which indicates that an extension of the parameter
range will probably not uncover SIMs that differ significantly from
those obtained with the chosen range.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">euro_models_df</span>, <span class="va">diversity</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-32-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="variability-plot-1">Variability plot<a class="anchor" aria-label="anchor" href="#variability-plot-1"></a>
</h3>
<p>The flow variability plot outlines a few cities as potentially
dominant. Lyon is the strongest. This is explained by its central
position on the map. We expect to find it as the single dominant city in
many configurations. Hook of Holland and Brussels also appear, but to a
lesser extent. Gibraltar is also potentially active in some
configurations. Athens and Stockholm are frequently the sole receivers
of their own flow, probably owing to their isolated positions.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">euro_models</span>, with_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-33-1.png" width="700">
Destination flows tell the same story. Notably, most of the cities have
a null median incoming flow, apart from Athens, Gibraltar, Lyon and
Stockholm. In addition, most of the cities have a 0.95 quantile of 1,
which corresponds to local configurations, that is situations when <span class="math inline">\(\beta\)</span> is large enough to prevent any
external flow. Only Brussels and Hook of Holland stand out (in addition
to the four cities mentioned above).</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">euro_models</span>, flows <span class="op">=</span> <span class="st">"destination"</span>, with_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-34-1.png" width="700"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">euro_models</span>,</span>
<span>  flows <span class="op">=</span> <span class="st">"destination"</span>, with_positions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  with_names <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>default_crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-35-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="clustering">Clustering<a class="anchor" aria-label="anchor" href="#clustering"></a>
</h3>
<p>We apply the same clustering strategy as with the artificial data: 16
clusters obtained with hierarchical clustering using the Ward
criterion.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">euro_models_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_distance.html">sim_distance</a></span><span class="op">(</span><span class="va">euro_models</span>, <span class="st">"destination"</span><span class="op">)</span></span>
<span><span class="va">euro_models_hc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="va">euro_models_dist</span>, method <span class="op">=</span> <span class="st">"ward.D2"</span><span class="op">)</span></span></code></pre></div>
<p>The dendrogram clearly shows three main clusters, but as explained
above, the role of clustering is to allow exploration of the result
spaces rather than to find actual clusters.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">euro_models_hc</span>, hang <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, labels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-37-1.png" width="700"></p>
<p>The clusters are well organised on the parameter set.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">euro_models_df</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cutree.html" class="external-link">cutree</a></span><span class="op">(</span><span class="va">euro_models_hc</span>, k <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">euro_models_df</span>, <span class="va">cluster</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-38-1.png" width="768" style="display: block; margin: auto;"></p>
<p>The variability plot shows mostly isolated circles with no inner or
outer ring. This means that the clusters are relatively homogeneous in
terms of destination flows, and thus median flows will give a good idea
of typical behaviours.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/grid_var_autoplot.html">grid_var_autoplot</a></span><span class="op">(</span><span class="va">euro_models_df</span>, <span class="va">cluster</span>,</span>
<span>  flows <span class="op">=</span> <span class="st">"destination"</span>,</span>
<span>  with_positions <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>default_crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-39-1.png" width="816" style="display: block; margin: auto;"></p>
<p>Those behaviours are visible both at the destination flow level
(above) and at the flow level (below):</p>
<ul>
<li>Clusters 1 to 3 correspond to situations where most of the flows are
local (hence the importance of the diagonal flow), with a progressive
shift towards sending flow to Lyon. Brussels is also important in
clusters 2 and 3.</li>
<li>Clusters 4, 6 and 7 maintain a relatively strong diagonal (self)
flow with more flows sent to Lyon and a transition between Brussels and
Hook of Holland</li>
<li>Clusters 5, 8 and 9 are intermediate situations where some cities
play the role of local attractors, e.g., Rome and Vienna, but the
concentration on external cities and Lyon and Brussels (5 and 8) or Hook
of Holland (9) is progressing.</li>
<li>Clusters 10 to 12 are situations where both Lyon and Hook of Holland
share incoming flows, with more (10) or fewer (12) flows reaching
external cities such as Stockholm, Athens and the trio Gibraltar, Lisbon
and Madrid.</li>
<li>Clusters 13 to 15 show Lyon as the dominating city, while in cluster
16, Lyon shares its incoming flow with Hook of Holland.</li>
</ul>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/grid_var_autoplot.html">grid_var_autoplot</a></span><span class="op">(</span><span class="va">euro_models_df</span>, <span class="va">cluster</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-40-1.png" width="816" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="medoids">Medoids<a class="anchor" aria-label="anchor" href="#medoids"></a>
</h3>
<p>Finally, we look at medoids.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">euro_models_center</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_list.html">sim_list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">euro_models</span>, <span class="va">euro_models_df</span><span class="op">$</span><span class="va">cluster</span>,</span>
<span>  <span class="va">median</span>,</span>
<span>  flows <span class="op">=</span> <span class="st">"destination"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">euro_models_center_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_df.html">sim_df</a></span><span class="op">(</span><span class="va">euro_models_center</span><span class="op">)</span></span></code></pre></div>
<p>The medoids confirm the analysis given above.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/grid_autoplot.html">grid_autoplot</a></span><span class="op">(</span><span class="va">euro_models_center_df</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"white"</span>, high <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-42-1.png" width="816" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/grid_autoplot.html">grid_autoplot</a></span><span class="op">(</span><span class="va">euro_models_center_df</span>,</span>
<span>  flows <span class="op">=</span> <span class="st">"destination"</span>,</span>
<span>  with_positions <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>default_crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-43-1.png" width="816" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/grid_autoplot.html">grid_autoplot</a></span><span class="op">(</span><span class="va">euro_models_center_df</span>,</span>
<span>  with_positions <span class="op">=</span> <span class="cn">TRUE</span>, arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.015</span>, <span class="st">"npc"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linewidth.html" class="external-link">scale_linewidth_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>default_crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-44-1.png" width="816" style="display: block; margin: auto;"></p>
<p>To further the analysis, one can focus on a particular medoid, for
instance cluster 1:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">euro_models_center</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  flows <span class="op">=</span> <span class="st">"full"</span>, with_positions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.015</span>, <span class="st">"npc"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linewidth.html" class="external-link">scale_linewidth_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>default_crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-45-1.png" width="700"></p>
<p>Or cluster 5:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">euro_models_center</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  flows <span class="op">=</span> <span class="st">"full"</span>, with_positions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.015</span>, <span class="st">"npc"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linewidth.html" class="external-link">scale_linewidth_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>default_crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-46-1.png" width="700"></p>
<p>Finally, one can randomly select a subset of the models in a cluster
and use <code><a href="../reference/grid_autoplot.html">grid_autoplot()</a></code> to display these models all at
once. This offers a way to visually assess the variability within that
cluster. For instance, in the figure below for cluster 4, most of the
models are very similar, but some differences exist, such as the flows
to Hamburg and Copenhagen, whose level varies across the configurations
(compare 6 to 7, for instance).</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">euro_models_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">euro_models_df</span><span class="op">$</span><span class="va">cluster</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span>, <span class="fl">16</span><span class="op">)</span></span>
<span><span class="va">euro_models_cl4_sample</span> <span class="op">&lt;-</span> <span class="va">euro_models</span><span class="op">[</span><span class="va">euro_models_idx</span><span class="op">]</span></span>
<span><span class="va">euro_models_cl4_sample_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_df.html">sim_df</a></span><span class="op">(</span><span class="va">euro_models_cl4_sample</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/grid_autoplot.html">grid_autoplot</a></span><span class="op">(</span><span class="va">euro_models_cl4_sample_df</span>, with_positions <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linewidth.html" class="external-link">scale_linewidth_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>default_crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_files/figure-html/unnamed-chunk-47-1.png" width="816" style="display: block; margin: auto;"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Fabrice Rossi.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
