<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Boltzmann–Lotka–Volterra Interaction Model • blvim</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Boltzmann–Lotka–Volterra Interaction Model">
<meta name="description" content="Estimates Boltzmann–Lotka–Volterra (BLV) interaction model efficiently. See Wilson, A. (2008) &lt;dx.doi.org/10.1098/rsif.2007.1288&gt;.">
<meta property="og:description" content="Estimates Boltzmann–Lotka–Volterra (BLV) interaction model efficiently. See Wilson, A. (2008) &lt;dx.doi.org/10.1098/rsif.2007.1288&gt;.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">blvim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/grid.html">Systematic exploration of the BLV solution space</a></li>
    <li><a class="dropdown-item" href="articles/theory.html">Theoretical Background</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/fabrice-rossi/blvim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="boltzmannlotkavolterra-interaction-model">Boltzmann–Lotka–Volterra Interaction Model<a class="anchor" aria-label="anchor" href="#boltzmannlotkavolterra-interaction-model"></a>
</h1></div>
<!-- badges: start -->

<!-- badges: end -->
<p><code>blvim</code> implements A. Wilson’s <strong>Boltzmann–Lotka–Volterra (BLV) interaction model</strong>. The model is described in <a href="http://dx.doi.org/10.1098/rsif.2007.1288" class="external-link">Wilson, A. (2008), “Boltzmann, Lotka and Volterra and spatial structural evolution: an integrated methodology for some dynamical systems”, J. R. Soc. Interface, 5:865–871</a>.</p>
<p>The package’s primary goal is to provide a fast implementation of the BLV model, complete with a collection of tools designed to explore the results through statistical summaries and graphical representations. The secondary goal is to facilitate the systematic assessment of how model parameters impact the results, again using summaries and graphical representations (see <code><a href="articles/grid.html">vignette("grid")</a></code> for details on this aspect).</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of <code>blvim</code> from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"fabrice-rossi/blvim"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="spatial-interaction-models">Spatial interaction models<a class="anchor" aria-label="anchor" href="#spatial-interaction-models"></a>
</h2>
<p><strong>Spatial interaction models</strong> aim to estimate flows between locations, such as workers commuting from residential zones to employment zones. The <code>blvim</code> package focuses on the maximum entropy models developed by Alan Wilson. See <code><a href="articles/theory.html">vignette("theory")</a></code> for the theoretical background.</p>
<p>In practice, if we have <span class="math inline">\(n\)</span> origin locations and <span class="math inline">\(p\)</span> destination locations, the goal is to compute a flow matrix <span class="math inline">\((Y_{ij})_{1\leq i\leq n, 1\leq j\leq p}\)</span>, where <span class="math inline">\(Y_{ij}\)</span> is the flow from origin <span class="math inline">\(i\)</span> to destination <span class="math inline">\(j\)</span>. This computation relies on characteristics of the origin and destination locations, along with a matrix of exchange difficulties, known as a <strong>cost matrix</strong>, <span class="math inline">\((c_{ij})_{1\leq i\leq n, 1\leq j\leq p}\)</span>. For example, <span class="math inline">\(c_{ij}\)</span> can represent the distance between origin <span class="math inline">\(i\)</span> and destination <span class="math inline">\(j\)</span>.</p>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>The package is loaded in a standard way.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fabrice-rossi.github.io/blvim/">blvim</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="input-data">Input data<a class="anchor" aria-label="anchor" href="#input-data"></a>
</h3>
<p>To compute a spatial interaction model with <code>blvim</code>, you need at least a cost matrix. The package comes with distance data for a selection of large French cities. We use the 30 largest ones as origin locations and the 20 smallest ones as destination locations. The cost matrix is the distance between the cities (in meters).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 30 largest cities</span></span>
<span><span class="va">origins</span> <span class="op">&lt;-</span> <span class="va">french_cities</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"th_longitude"</span>, <span class="st">"th_latitude"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">## 20 smallest cities</span></span>
<span><span class="va">destinations</span> <span class="op">&lt;-</span> <span class="va">french_cities</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">french_cities</span><span class="op">)</span> <span class="op">-</span> <span class="fl">19</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">french_cities</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"th_longitude"</span>, <span class="st">"th_latitude"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">## cost matrix</span></span>
<span><span class="va">cost_matrix</span> <span class="op">&lt;-</span> <span class="va">french_cities_distance</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span>, <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">french_cities</span><span class="op">)</span> <span class="op">-</span> <span class="fl">19</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">french_cities</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">cost_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">french_cities</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span>, <span class="st">"name"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cost_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">french_cities</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">french_cities</span><span class="op">)</span> <span class="op">-</span> <span class="fl">19</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">french_cities</span><span class="op">)</span>, <span class="st">"name"</span><span class="op">]</span></span></code></pre></div>
<p>Additionally, since we focus on <strong>production-constrained models</strong>, we must specify the production for each origin location (a vector of positive values <span class="math inline">\((X_i)_{1\leq i\leq n}\)</span>). Here, we assume a common unitary production.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">origins</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Finally, the simple <strong>static</strong> model requires an attractiveness value for each destination location, a vector of positive values <span class="math inline">\((Z_j)_{1\leq j\leq p}\)</span>. We again assume a common unitary attractiveness.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">destinations</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We could use the population of the cities as production constraints for instance.</p>
</div>
<div class="section level3">
<h3 id="static-models">Static models<a class="anchor" aria-label="anchor" href="#static-models"></a>
</h3>
<p>In Wilson’s production-constrained maximum entropy model, the flows are given by</p>
<p><span class="math display">\[
Y_{ij} = \frac{X_iZ_j^{\alpha}\exp(-\beta c_{ij})}{\sum_{k=1}^pZ_k^{\alpha}\exp(-\beta c_{ik})},
\]</span></p>
<p>where <span class="math inline">\(\alpha\)</span> is a return-to-scale parameter and <span class="math inline">\(\beta\)</span> is the inverse of a cost scale parameter. Note that the flow matrix is <strong>production-constrained</strong>, meaning that the total outgoing flow from any origin location is equals the production of that location:</p>
<p><span class="math display">\[
\forall i,\quad X_i=\sum_{j=1}^{p}Y_{ij}.
\]</span></p>
<p>The model is obtained using the <code><a href="reference/static_blvim.html">static_blvim()</a></code> function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/static_blvim.html">static_blvim</a></span><span class="op">(</span><span class="va">cost_matrix</span>, <span class="va">X</span>, alpha <span class="op">=</span> <span class="fl">1.1</span>, beta <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">500000</span>, <span class="va">Z</span><span class="op">)</span></span>
<span><span class="va">a_model</span></span>
<span><span class="co">#&gt; Spatial interaction model with 30 origin locations and 20 destination locations</span></span>
<span><span class="co">#&gt; • Model: Wilson's production constrained</span></span>
<span><span class="co">#&gt; • Parameters: return to scale (alpha) = 1.1 and inverse cost scale (beta) =</span></span>
<span><span class="co">#&gt; 2e-06</span></span></code></pre></div>
<p>Several functions are provided to extract parts of the result. In particular <code><a href="reference/flows.html">flows()</a></code> returns the flow matrix <span class="math inline">\(Y\)</span>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a_model_flows</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flows.html">flows</a></span><span class="op">(</span><span class="va">a_model</span><span class="op">)</span></span></code></pre></div>
<p>which can be displayed using, for instance, the <code><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image()</a></code> function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">a_model_flows</span><span class="op">)</span><span class="op">[</span>, <span class="fl">30</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">gray.colors</a></span><span class="op">(</span><span class="fl">20</span>, start <span class="op">=</span> <span class="fl">1</span>, end <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  frame <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-a_flow-1.png" width="50%" style="display: block; margin: auto;"></p>
<p>In this representation, each row shows the flows from one origin location to all destination locations. The package also provides a <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">ggplot2::autoplot()</a></code> function, which can be used as follows:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">a_model</span>, <span class="st">"full"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"white"</span>, high <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-a_flow_ggplot2-1.png" width="80%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/static_blvim.html">static_blvim</a></span><span class="op">(</span><span class="va">cost_matrix</span>, <span class="va">X</span>, alpha <span class="op">=</span> <span class="fl">1.1</span>, beta <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">100000</span>, <span class="va">Z</span><span class="op">)</span></span>
<span><span class="va">b_model</span></span>
<span><span class="co">#&gt; Spatial interaction model with 30 origin locations and 20 destination locations</span></span>
<span><span class="co">#&gt; • Model: Wilson's production constrained</span></span>
<span><span class="co">#&gt; • Parameters: return to scale (alpha) = 1.1 and inverse cost scale (beta) =</span></span>
<span><span class="co">#&gt; 1e-05</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">b_model</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"white"</span>, high <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-b_flow-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>As the two figures above exemplify, different values of the parameters <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> result in more or less concentrated flows.</p>
</div>
<div class="section level3">
<h3 id="dynamic-models">Dynamic models<a class="anchor" aria-label="anchor" href="#dynamic-models"></a>
</h3>
<p>A. Wilson’s <strong>Boltzmann–Lotka–Volterra (BLV) interaction model</strong> builds upon the production-constrained maximum entropy model. The core idea is to update the attractiveness of the destination locations based on their incoming flows.</p>
<p>Ideally, we aim for the following condition to hold in the limit:</p>
<p><span class="math display">\[
Z_j =\sum_{i=1}^{n}Y_{ij},
\]</span></p>
<p>where the flows are given by the equations above. The model is estimated using the <code><a href="reference/blvim.html">blvim()</a></code> function as follows.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a_blv_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/blvim.html">blvim</a></span><span class="op">(</span><span class="va">cost_matrix</span>, <span class="va">X</span>, alpha <span class="op">=</span> <span class="fl">1.1</span>, beta <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">500000</span>, <span class="va">Z</span><span class="op">)</span></span>
<span><span class="va">a_blv_model</span></span>
<span><span class="co">#&gt; Spatial interaction model with 30 origin locations and 20 destination locations</span></span>
<span><span class="co">#&gt; • Model: Wilson's production constrained</span></span>
<span><span class="co">#&gt; • Parameters: return to scale (alpha) = 1.1 and inverse cost scale (beta) =</span></span>
<span><span class="co">#&gt; 2e-06</span></span>
<span><span class="co">#&gt; ℹ The BLV model converged after 4800 iterations.</span></span></code></pre></div>
<p>Notice that we start with some initial values of the attractiveness, but the final values are different. These final values can be obtained using the <code><a href="reference/attractiveness.html">attractiveness()</a></code> function (and visualised here using a bar plot).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">a_final_Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/attractiveness.html">attractiveness</a></span><span class="op">(</span><span class="va">a_blv_model</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">a_final_Z</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-a_blv_Z-1.png" width="80%" style="display: block; margin: auto;"> In this particular example, one destination location acts as a global attractor of all the flows. This pattern is also visible in the final flow matrix.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">a_blv_model</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"white"</span>, high <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-a_blv_flow-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>The <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot()</a></code> function can also be used to show the destination flows or the attractivenesses values:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">a_blv_model</span>, <span class="st">"attractiveness"</span>, with_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-a_blv_Z_ggplot2-1.png" width="100%"></p>
<p>Naturally, the results are strongly influenced by the parameters, as shown in this second example.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b_blv_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/blvim.html">blvim</a></span><span class="op">(</span><span class="va">cost_matrix</span>, <span class="va">X</span>, alpha <span class="op">=</span> <span class="fl">1.1</span>, beta <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">50000</span>, <span class="va">Z</span><span class="op">)</span></span>
<span><span class="va">b_blv_model</span></span>
<span><span class="co">#&gt; Spatial interaction model with 30 origin locations and 20 destination locations</span></span>
<span><span class="co">#&gt; • Model: Wilson's production constrained</span></span>
<span><span class="co">#&gt; • Parameters: return to scale (alpha) = 1.1 and inverse cost scale (beta) =</span></span>
<span><span class="co">#&gt; 2e-05</span></span>
<span><span class="co">#&gt; ℹ The BLV model converged after 5700 iterations.</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">b_blv_model</span>, <span class="st">"attractiveness"</span>, with_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-b_blv_Z-1.png" width="100%"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">b_blv_model</span>, with_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"white"</span>, high <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-b_blv_flow-1.png" width="80%" style="display: block; margin: auto;"></p>
<p><code>bvlim</code> offers a collection of graphical representations that can leverage the data associated to the origin and destination locations. For instance, we can display the full flows using geographical coordinates of the cities.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/origin_positions.html">origin_positions</a></span><span class="op">(</span><span class="va">b_blv_model</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">origins</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/destination_positions.html">destination_positions</a></span><span class="op">(</span><span class="va">b_blv_model</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">destinations</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">b_blv_model</span>,</span>
<span>  with_positions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="st">"npc"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linewidth.html" class="external-link">scale_linewidth</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"epsg:4326"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">origins</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">th_longitude</span>, y <span class="op">=</span> <span class="va">th_latitude</span><span class="op">)</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"blueviolet"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">3</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">destinations</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">th_longitude</span>, y <span class="op">=</span> <span class="va">th_latitude</span><span class="op">)</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"darkorange"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">3</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-b_blv_france-1.png" width="100%"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/fabrice-rossi/blvim/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/fabrice-rossi/blvim/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing blvim</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Fabrice Rossi <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-4638-1286" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/fabrice-rossi/blvim/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/fabrice-rossi/blvim/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/fabrice-rossi/blvim" class="external-link"><img src="https://codecov.io/gh/fabrice-rossi/blvim/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Fabrice Rossi.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
